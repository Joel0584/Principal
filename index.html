<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Médica Domiciliaria</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data.min.js"></script>
    <script>
        moment.locale('es');
        moment.tz.setDefault("America/Caracas");
    </script>
    <style>
        :root {
            --primary-blue: #2563eb;
            --secondary-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --light-bg: #f0f5ff;
            --light-bg-alt: #e6f7ff;
            --light-text: #ffffff;
            --dark-text: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-bg), var(--light-bg-alt));
            color: var(--dark-text);
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px 0;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header más compacto con animaciones */
        header {
            background: linear-gradient(120deg, var(--primary-blue), var(--secondary-blue));
            color: var(--light-text);
            text-align: center;
            padding: 12px 0;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--accent-green);
            animation: slideIn 0.6s ease-out forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0 20px;
        }
        
        .logo-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 8px;
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        header h1 {
            font-size: 1.5rem;
            margin-bottom: 4px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
            animation: fadeIn 0.8s 0.3s ease-out both;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tagline {
            font-size: 0.95rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            animation: fadeIn 0.8s 0.5s ease-out both;
        }
        
        .current-time {
            background: rgba(255, 255, 255, 0.15);
            display: inline-block;
            padding: 6px 15px;
            border-radius: 30px;
            margin-top: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 0.8s 0.7s ease-out both;
        }
        
        .header-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        /* Banner más compacto */
        .exchange-banner {
            background: linear-gradient(90deg, var(--accent-purple), #7c3aed);
            color: var(--light-text);
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin: 12px 0;
            box-shadow: var(--shadow);
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Main content más compacto */
        .content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-section {
            background: var(--card-bg);
            padding: 18px;
            border-radius: 18px;
            box-shadow: var(--shadow);
        }
        
        .section-title {
            color: var(--primary-blue);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 3px solid var(--accent-green);
            font-weight: 600;
            font-size: 1.2rem;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent-purple);
            border-radius: 3px;
        }
        
        /* Form section más compacto */
        .form-group {
            margin-bottom: 10px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--primary-blue);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background: var(--light-bg-alt);
            font-family: 'Poppins', sans-serif;
        }
        
        .form-group textarea {
            min-height: 70px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }
        
        .zone-container {
            display: none;
        }
        
        .note {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 3px;
            padding-left: 8px;
            font-style: italic;
        }
        
        /* Banner de precio más compacto */
        .price-display {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid var(--primary-blue);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.1);
        }
        
        .price-info {
            flex: 1;
            min-width: 200px;
            padding: 6px;
        }
        
        .price-label {
            font-size: 0.9rem;
            color: var(--primary-blue);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .price-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark-text);
        }
        
        .price-secondary {
            font-size: 0.85rem;
            color: #64748b;
        }
        
        .price-ves {
            background: rgba(16, 185, 129, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 6px;
            font-size: 0.85rem;
        }
        
        .minor-note {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 10px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 0.85rem;
            color: #92400e;
        }
        
        /* Métodos de pago más compactos */
        .payment-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 12px 0;
        }
        
        .payment-option {
            flex: 1;
            min-width: 90px;
            padding: 8px;
            background: var(--light-bg);
            border: 2px solid #dbeafe;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .payment-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-blue);
        }
        
        .payment-option.selected {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }
        
        .payment-option.selected::after {
            content: "\f00c";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-green);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .payment-option i {
            font-size: 1.2rem;
            margin-bottom: 6px;
            display: block;
            transition: var(--transition);
        }
        
        .payment-option.selected i {
            transform: scale(1.1);
        }
        
        .submit-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(120deg, var(--accent-green), #059669);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 12px;
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(120deg, #059669, var(--accent-green));
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.4);
        }
        
        /* Benefits section más compacto */
        .benefits-section {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
            padding: 20px 12px;
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .benefits-title {
            text-align: center;
            color: white;
            margin-bottom: 15px;
            font-size: 1.3rem;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
        }
        
        .benefits-title::after {
            content: "";
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--accent-green);
            border-radius: 3px;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }
        
        .benefit-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: var(--transition);
        }
        
        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .benefit-icon {
            font-size: 2rem;
            color: var(--accent-purple);
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .benefit-card h3 {
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .benefit-card p {
            font-size: 0.8rem;
            line-height: 1.6;
            color: var(--dark-text);
        }
        
        /* Footer más compacto */
        footer {
            text-align: center;
            padding: 12px;
            color: white;
            margin-top: 20px;
            font-size: 0.8rem;
            background: linear-gradient(120deg, var(--primary-blue), var(--secondary-blue));
            border-radius: 16px;
            box-shadow: var(--shadow);
        }
        
        footer p {
            margin: 4px 0;
        }
        
        .whatsapp-icon {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: var(--accent-green);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.4);
            z-index: 100;
            cursor: pointer;
            animation: pulse 1.8s infinite;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .whatsapp-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.6);
            animation: none;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        /* Modal de condiciones más compacto */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            background: linear-gradient(120deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 12px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.2rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        .modal-content {
            padding: 15px;
        }
        
        .terms-container {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            max-height: 280px;
            overflow-y: auto;
            font-size: 0.8rem;
        }
        
        .terms-container h3 {
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .terms-container p {
            margin-bottom: 6px;
            line-height: 1.6;
        }
        
        .terms-container ul {
            padding-left: 18px;
            margin-bottom: 8px;
        }
        
        .terms-container li {
            margin-bottom: 5px;
        }
        
        .accept-terms {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
            font-size: 0.9rem;
        }
        
        .accept-terms input {
            width: 16px;
            height: 16px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 9px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
            font-family: 'Poppins', sans-serif;
        }
        
        .modal-btn.cancel {
            background: #f1f5f9;
            color: #64748b;
            border: 2px solid #cbd5e1;
        }
        
        .modal-btn.cancel:hover {
            background: #e2e8f0;
        }
        
        .modal-btn.confirm {
            background: var(--accent-green);
            color: white;
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }
        
        .modal-btn.confirm:hover {
            background: #059669;
        }
        
        .success-message {
            text-align: center;
            padding: 15px;
        }
        
        .success-message i {
            font-size: 3rem;
            color: var(--accent-green);
            margin-bottom: 12px;
        }
        
        .success-message h2 {
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 1.3rem;
        }
        
        /* Modal de gestión de citas más compacto */
        .appointment-card {
            background: #f1f5f9;
            border-radius: 10px;
            padding: 10px;
            margin: 6px 0;
            border-left: 4px solid var(--accent-green);
        }
        
        .appointment-card h3 {
            color: var(--primary-blue);
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .appointment-card p {
            margin: 3px 0;
            font-size: 0.8rem;
        }
        
        .cancel-appointment-btn {
            background: #fee2e2;
            color: #b91c1c;
            border: none;
            padding: 5px 10px;
            border-radius: 6px;
            margin-top: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.8rem;
        }
        
        .cancel-appointment-btn:hover {
            background: #fecaca;
        }
        
        .empty-state {
            text-align: center;
            padding: 15px;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .empty-state i {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #cbd5e1;
        }
        
        /* Responsive design */
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .benefits-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 992px) {
            .benefits-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Nuevos estilos para reserva de dos personas */
        .two-persons-container {
            background: #f0f9ff;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            border: 1px solid #dbeafe;
        }
        
        .two-persons-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .two-persons-toggle input {
            width: 16px;
            height: 16px;
        }
        
        .additional-person {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            border: 1px solid #e0e7ff;
        }
        
        .additional-person.active {
            display: block;
        }
        
        .additional-person h3 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            font-size: 1rem;
            border-bottom: 1px solid #e0e7ff;
            padding-bottom: 6px;
        }
        
        /* Nuevo estilo para zona restringida */
        .restricted-zone {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.85rem;
            color: #856404;
        }
        
        /* Nuevos campos médicos */
        .medical-info {
            background: #f8fafc;
            border-left: 4px solid var(--accent-purple);
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
        }
        
        .medical-info h3 {
            color: var(--accent-purple);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabecera más pequeña con animaciones -->
        <header>
            <div class="header-actions">
                <button class="action-btn" id="manageAppointmentBtn">
                    <i class="fas fa-calendar-check"></i> Gestionar Cita
                </button>
            </div>
            
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div>
                    <h1>Consulta Médica Domiciliaria</h1>
                    <p class="tagline">Medicina General</p>
                </div>
            </div>
            <div class="current-time" id="current-time">
                <i class="fas fa-clock"></i> <span id="time-display">Cargando hora...</span>
            </div>
        </header>
        
        <!-- Banner de tasa BCV actualizada -->
        <div class="exchange-banner">
            <i class="fas fa-money-bill-wave"></i> Tasa de cambio oficial BCV: $1 = 135.00 Bs
        </div>
        
        <div class="content-wrapper">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-file-medical"></i> Solicita tu Consulta Médica</h2>
                
                <form id="medicalForm">
                    <div class="form-group">
                        <label for="fullName"><i class="fas fa-user"></i> Nombre y Apellido *</label>
                        <input type="text" id="fullName" name="fullName" required placeholder="Ej: Juan Pérez">
                    </div>
                    
                    <div class="form-group">
                        <label for="age"><i class="fas fa-birthday-cake"></i> Edad *</label>
                        <input type="number" id="age" name="age" min="1" max="120" required placeholder="Ej: 35">
                    </div>
                    
                    <div class="form-group">
                        <label for="idNumber"><i class="fas fa-id-card"></i> Número de Cédula *</label>
                        <input type="text" id="idNumber" name="idNumber" required placeholder="Ej: V-12345678">
                        <div class="note">En caso de no poseer, agregar el número de cédula de la madre o representante legal.</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone"><i class="fas fa-mobile-alt"></i> Número de Celular *</label>
                        <input type="tel" id="phone" name="phone" required placeholder="Ej: 04121234567" pattern="[0-9]{11}">
                    </div>
                    
                    <!-- Municipio -->
                    <div class="form-group">
                        <label for="municipality"><i class="fas fa-map"></i> Municipio *</label>
                        <select id="municipality" name="municipality" required>
                            <option value="">Seleccione un municipio</option>
                            <option value="acevedo">Acevedo</option>
                            <option value="brion">Brion</option>
                        </select>
                    </div>
                    
                    <!-- Parroquia dependiente del municipio -->
                    <div class="form-group">
                        <label for="parish"><i class="fas fa-map-marker-alt"></i> Parroquia *</label>
                        <select id="parish" name="parish" required disabled>
                            <option value="">Seleccione una parroquia</option>
                        </select>
                    </div>
                    
                    <!-- Contenedores para zonas según parroquia -->
                    <div id="caucaguaZones" class="zone-container">
                        <div class="form-group">
                            <label for="caucaguaZone"><i class="fas fa-location-dot"></i> Zona de Caucagua *</label>
                            <select id="caucaguaZone" name="zone">
                                <option value="">Seleccione una zona</option>
                                <option value="La línea">La línea</option>
                                <option value="El Viento">El Viento</option>
                                <option value="El Hoyo">El Hoyo</option>
                                <option value="El Cacho">El Cacho</option>
                                <option value="Tajamar">Tajamar</option>
                                <option value="Rivas Dávila">Rivas Dávila</option>
                                <option value="Terminal">Terminal</option>
                                <option value="La Libertad">La Libertad</option>
                                <option value="Calle Acevedo">Calle Acevedo</option>
                                <option value="Plaza Bolívar">Plaza Bolívar</option>
                                <option value="Las Brisas">Las Brisas</option>
                                <option value="Calle Julio Isturis">Calle Julio Isturis</option>
                                <option value="Macaguita parte baja">Macaguita parte baja</option>
                                <option value="El Recreo (Calle Bolívar)">El Recreo (Calle Bolívar)</option>
                                <option value="El Zamuro">El Zamuro</option>
                                <option value="El Rincón">El Rincón</option>
                                <option value="Las Clavellinas">Las Clavellinas</option>
                                <option value="El Placer">El Placer</option>
                                <option value="Las Colonias">Las Colonias</option>
                                <option value="El Cedral">El Cedral</option>
                                <option value="Palmarito">Palmarito</option>
                                <option value="La Laguna">La Laguna</option>
                                <option value="El Cumbito">El Cumbito</option>
                                <option value="Viamar">Viamar</option>
                                <option value="Los Robles">Los Robles</option>
                                <option value="Los Cedros">Los Cedros</option>
                                <option value="Río Grande">Río Grande</option>
                                <option value="El Porvenir">El Porvenir</option>
                                <option value="Encrucijada">Encrucijada</option>
                                <option value="Quebrada Seca">Quebrada Seca</option>
                                <option value="Chaguaramas">Chaguaramas</option>
                                <option value="Merecure el puente">Merecure el puente</option>
                                <option value="Merecure San Jacinto">Merecure San Jacinto</option>
                                <option value="Merecure el centro">Merecure el centro</option>
                                <option value="Cholondron">Cholondron</option>
                                <option value="Novillo 1">Novillo 1</option>
                                <option value="Novillo 2">Novillo 2</option>
                                <option value="Cacique Acevedo">Cacique Acevedo</option>
                                <option value="Altos de Mesa de Urape">Altos de Mesa de Urape</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="marizapaZones" class="zone-container">
                        <div class="form-group">
                            <label for="marizapaZone"><i class="fas fa-location-dot"></i> Zona de Marizapa *</label>
                            <select id="marizapaZone" name="zone">
                                <option value="">Seleccione una zona</option>
                                <option value="Villa Docencia">Villa Docencia</option>
                                <option value="Calle Principal de Marizapa">Calle Principal de Marizapa</option>
                                <option value="Plaza Bolívar de Marizapa">Plaza Bolívar de Marizapa</option>
                                <option value="José Gregorio">José Gregorio</option>
                                <option value="Santa Eduviges">Santa Eduviges</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="higueroteZones" class="zone-container">
                        <div class="form-group">
                            <label for="higueroteZone"><i class="fas fa-location-dot"></i> Zona de Higuerote *</label>
                            <select id="higueroteZone" name="zone">
                                <option value="">Seleccione una zona</option>
                                <option value="Casco central de Higuerote">Casco central de Higuerote</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Mensaje para zonas restringidas -->
                    <div id="restrictedZoneMessage" class="restricted-zone" style="display:none;">
                        <i class="fas fa-exclamation-triangle"></i> Para esta zona, no está disponible el pago en efectivo. Por favor, seleccione otro método de pago.
                    </div>
                    
                    <!-- Nuevos campos agregados -->
                    <div class="form-group">
                        <label for="address"><i class="fas fa-home"></i> Dirección Exacta *</label>
                        <textarea id="address" name="address" required placeholder="Ingrese su dirección exacta"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="reference"><i class="fas fa-map-pin"></i> Punto de Referencia</label>
                        <input type="text" id="reference" name="reference" placeholder="Ej: Frente al supermercado, casa azul, etc.">
                    </div>
                    
                    <!-- Nuevos campos médicos -->
                    <div class="medical-info">
                        <h3><i class="fas fa-stethoscope"></i> Información Médica</h3>
                        
                        <div class="form-group">
                            <label for="consultReason"><i class="fas fa-question-circle"></i> Motivo de Consulta *</label>
                            <input type="text" id="consultReason" name="consultReason" required placeholder="Ej: Dolor de cabeza, fiebre, revisión médica...">
                        </div>
                        
                        <div class="form-group">
                            <label for="symptoms"><i class="fas fa-heartbeat"></i> Signos y Síntomas *</label>
                            <textarea id="symptoms" name="symptoms" required placeholder="Describa los síntomas que presenta el paciente, duración, intensidad, etc."></textarea>
                        </div>
                    </div>
                    
                    <!-- Nuevo banner de precio moderno -->
                    <div id="priceDisplay" class="price-display">
                        <div class="price-info">
                            <div class="price-label">
                                <i class="fas fa-tag"></i> Precio de la consulta
                            </div>
                            <div class="price-value">$<span id="usdPrice">15.00</span></div>
                            <div class="price-secondary" id="priceType">(General)</div>
                        </div>
                        
                        <div class="price-ves">
                            <div><i class="fas fa-money-bill"></i> Equivalente en Bolívares</div>
                            <div class="price-value"><span id="vesPrice">2025.00</span> Bs</div>
                            <div class="price-secondary">(Tasa BCV: 135.00 Bs/$)</div>
                        </div>
                    </div>
                    
                    <!-- Reserva para dos personas -->
                    <div class="two-persons-container">
                        <div class="two-persons-toggle">
                            <input type="checkbox" id="twoPersons">
                            <label for="twoPersons">Reservar para dos personas</label>
                        </div>
                        
                        <div class="additional-person" id="additionalPerson">
                            <h3>Información de la segunda persona</h3>
                            
                            <div class="form-group">
                                <label for="fullName2"><i class="fas fa-user"></i> Nombre y Apellido *</label>
                                <input type="text" id="fullName2" name="fullName2" placeholder="Ej: María Rodríguez">
                            </div>
                            
                            <div class="form-group">
                                <label for="age2"><i class="fas fa-birthday-cake"></i> Edad *</label>
                                <input type="number" id="age2" name="age2" min="1" max="120" placeholder="Ej: 28">
                            </div>
                            
                            <div class="form-group">
                                <label for="idNumber2"><i class="fas fa-id-card"></i> Número de Cédula *</label>
                                <input type="text" id="idNumber2" name="idNumber2" placeholder="Ej: V-87654321">
                            </div>
                        </div>
                    </div>
                    
                    <div class="minor-note">
                        <i class="fas fa-exclamation-circle"></i> Todo paciente menor de edad debe de estar acompañado de su representante al momento de la consulta domiciliaria.
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-credit-card"></i> Método de Pago *</label>
                        <div class="payment-options">
                            <div class="payment-option" data-payment="pago-movil">
                                <i class="fas fa-mobile-alt"></i>
                                <div>Pago Móvil</div>
                            </div>
                            <div class="payment-option" data-payment="transferencia">
                                <i class="fas fa-exchange-alt"></i>
                                <div>Transferencia</div>
                            </div>
                            <div class="payment-option" data-payment="vepos">
                                <i class="fas fa-wallet"></i>
                                <div>Monedero Patria</div>
                            </div>
                            <div class="payment-option" data-payment="efectivo" id="cashOption">
                                <i class="fas fa-money-bill-wave"></i>
                                <div>Efectivo</div>
                            </div>
                        </div>
                        <input type="hidden" id="paymentMethod" name="paymentMethod">
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-paper-plane"></i> Solicitar Consulta
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Sección de beneficios -->
        <div class="benefits-section">
            <div class="benefits-container">
                <h2 class="benefits-title">Beneficios de Nuestro Servicio</h2>
                <div class="benefits-grid">
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3>Comodidad en tu Hogar</h3>
                        <p>Recibe atención médica profesional sin salir de casa, evitando desplazamientos y tiempos de espera en clínicas u hospitales.</p>
                    </div>
                    
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3>Atención Personalizada</h3>
                        <p>Consulta médica completa con tiempo suficiente para resolver todas tus dudas y preocupaciones de manera detallada.</p>
                    </div>
                    
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h3>Prevención y Seguimiento</h3>
                        <p>Control de enfermedades crónicas, seguimiento postoperatorio y detección temprana de problemas de salud.</p>
                    </div>
                    
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Entorno Seguro</h3>
                        <p>Reduce el riesgo de contagio de enfermedades infecciosas evitando salas de espera y transporte público.</p>
                    </div>
                    
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Atención Familiar</h3>
                        <p>Posibilidad de atender a varios miembros de la familia en una sola visita, especialmente beneficioso para niños y adultos mayores.</p>
                    </div>
                    
                    <div class="benefit-card">
                        <div class="benefit-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3>Horarios Flexibles</h3>
                        <p>Ofrecemos horarios adaptados a tus necesidades, incluso fines de semana, para que recibas atención cuando más lo necesites.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Consulta Médica Domiciliaria © <span id="current-year"></span></p>
            <p><i class="fas fa-phone"></i> Contáctanos: 0426-4968774 | <i class="fas fa-envelope"></i> aces24salud@gmail.com</p>
            <p><i class="fas fa-clock"></i> Horario de atención al público: de lunes a viernes desde 8:00 am a 4:00 pm.</p>
        </footer>
    </div>
    
    <a href="https://wa.me/584264968774" class="whatsapp-icon" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <!-- Modal de condiciones -->
    <div class="modal-overlay" id="termsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Confirmación de Solicitud</h2>
                <button class="close-modal" id="closeModal">×</button>
            </div>
            <div class="modal-content">
                <div class="info-summary" id="infoSummary">
                    <!-- Resumen de información se llenará aquí -->
                </div>
                
                <div class="terms-container">
                    <h3>CONDICIONES DE PAGO</h3>
                    
                    <p>1. MÉTODOS DE PAGO ACEPTADOS:</p>
                    <p>Facilitamos su experiencia con múltiples opciones:</p>
                    <ul>
                        <li>Transferencias bancarias.</li>
                        <li>Pago móvil interbancario.</li>
                        <li>Monedero Patria.</li>
                        <li>Efectivo (en Bolívares o divisas).</li>
                    </ul>
                    
                    <p>2. TASA DE CAMBIO:</p>
                    <p>Los pagos en divisas se calcularán según la tasa oficial vigente publicada por el Banco Central de Venezuela (BCV) al momento de la transacción.</p>
                    
                    <p>3. POLÍTICA DE REEMBOLSOS:</p>
                    <p>Las cancelaciones de servicios darán lugar a reembolsos procesados bajo las normativas legales venezolanas, previa evaluación de cada caso.</p>
                    
                    <p>4. PROTECCIÓN DE DATOS:</p>
                    <p>Sus datos personales se gestionan con estricto cumplimiento de la Ley de Protección de Datos Personales y regulaciones aplicables en Venezuela, garantizando confidencialidad y seguridad.</p>
                    
                    <p>5. CONFIRMACIÓN DE TRANSACCIONES:</p>
                    <p>Para validar su pago, deberá proporcionar:</p>
                    <ul>
                        <li>Número de cédula.</li>
                        <li>Comprobante de la transacción (según el método utilizado).</li>
                    </ul>
                    
                    <p>ACEPTACIÓN DE TÉRMINOS</p>
                    <p>Al solicitar servicios médicos, usted reconoce haber leído y aceptado estas condiciones de pago.</p>
                    
                    <p>COMPROMISO DE TRANSPARENCIA</p>
                    <p>Operamos bajo el marco legal de la República Bolivariana de Venezuela, asegurando procesos claros y auditables.</p>
                </div>
                
                <div class="accept-terms">
                    <input type="checkbox" id="acceptTerms">
                    <label for="acceptTerms">He leído y acepto las condiciones de pago</label>
                </div>
                
                <div class="modal-buttons">
                    <button class="modal-btn cancel" id="cancelBtn">Cancelar</button>
                    <button class="modal-btn confirm" id="confirmBtn" disabled>Confirmar y Enviar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de éxito -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Solicitud Exitosa</h2>
                <button class="close-modal" id="closeSuccessModal">×</button>
            </div>
            <div class="modal-content">
                <div class="success-message">
                    <i class="fas fa-check-circle"></i>
                    <h2>¡Solicitud Procesada Exitosamente!</h2>
                    <p>Tu información ha sido procesada correctamente.</p>
                    <p>Por favor continúa enviando la información a nuestro WhatsApp para completar tu reserva.</p>
                    <button class="modal-btn confirm" id="whatsappBtn">
                        <i class="fab fa-whatsapp"></i> Continuar a WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de gestión de citas -->
    <div class="modal-overlay" id="manageModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Gestionar mi Cita</h2>
                <button class="close-modal" id="closeManageModal">×</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="searchId"><i class="fas fa-id-card"></i> Ingrese su número de cédula *</label>
                    <input type="text" id="searchId" name="searchId" required placeholder="Ej: V-12345678">
                </div>
                
                <button class="submit-btn" id="searchAppointmentsBtn">
                    <i class="fas fa-search"></i> Buscar mis citas
                </button>
                
                <div id="appointmentsList" style="margin-top: 15px;">
                    <!-- Aquí se mostrarán las citas encontradas -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tasa de cambio actualizada del BCV
        const EXCHANGE_RATE = 135.00;
        
        // Almacenamiento de citas completas con fallback para GitHub Pages
        let appointments = [];
        
        // Intentar cargar datos desde localStorage
        try {
            appointments = JSON.parse(localStorage.getItem('appointments')) || [];
        } catch (e) {
            console.log("Error al cargar datos de localStorage, usando datos vacíos");
        }
        
        // Actualizar fecha y hora en tiempo real
        function updateDateTime() {
            const now = moment();
            const dateTimeString = now.format('dddd, D [de] MMMM [de] YYYY [|] h:mm:ss A');
            document.getElementById('time-display').textContent = dateTimeString;
        }
        
        // Actualizar año actual en el footer
        document.getElementById('current-year').textContent = moment().year();
        
        // Inicializar y actualizar cada segundo
        updateDateTime();
        setInterval(updateDateTime, 1000);
        
        // Función para actualizar los precios
        function updatePrices() {
            let totalPrice = 0;
            let priceType = "";
            
            // Precio para la primera persona
            const age = parseInt(document.getElementById('age').value) || 0;
            let price = 15.00;
            let priceType1 = "General";
            
            if (age < 13) {
                price = 12.00;
                priceType1 = "Niños";
            } else if (age >= 55) {
                price = 12.00;
                priceType1 = "Adultos Mayores";
            }
            
            totalPrice += price;
            
            // Precio para la segunda persona si está habilitada
            let priceType2 = "";
            if (document.getElementById('twoPersons').checked) {
                const age2 = parseInt(document.getElementById('age2').value) || 0;
                let price2 = 15.00;
                priceType2 = "General";
                
                if (age2 < 13) {
                    price2 = 12.00;
                    priceType2 = "Niños";
                } else if (age2 >= 55) {
                    price2 = 12.00;
                    priceType2 = "Adultos Mayores";
                }
                
                totalPrice += price2;
                priceType = `(${priceType1} + ${priceType2})`;
            } else {
                priceType = `(${priceType1})`;
            }
            
            // Calcular precio en bolívares
            const priceVES = (totalPrice * EXCHANGE_RATE).toFixed(2);
            
            // Actualizar elementos HTML
            document.getElementById('usdPrice').textContent = totalPrice.toFixed(2);
            document.getElementById('vesPrice').textContent = priceVES;
            document.getElementById('priceType').textContent = priceType;
        }
        
        // Inicializar precios
        updatePrices();
        
        // Lista de zonas restringidas sin pago en efectivo
        const restrictedZones = [
            "Quebrada Seca", "Chaguaramas", "Merecure el puente", 
            "Merecure San Jacinto", "Merecure el centro", "Cholondron", 
            "Novillo 1", "Novillo 2", "Cacique Acevedo", "Altos de Mesa de Urape"
        ];
        
        // Configurar municipio y parroquias
        document.getElementById('municipality').addEventListener('change', function() {
            const municipality = this.value;
            const parishSelect = document.getElementById('parish');
            parishSelect.disabled = !municipality;
            
            // Limpiar opciones anteriores
            parishSelect.innerHTML = '<option value="">Seleccione una parroquia</option>';
            
            // Ocultar todos los contenedores de zonas
            document.getElementById('caucaguaZones').style.display = 'none';
            document.getElementById('marizapaZones').style.display = 'none';
            document.getElementById('higueroteZones').style.display = 'none';
            document.getElementById('restrictedZoneMessage').style.display = 'none';
            
            // Llenar parroquias según municipio
            if (municipality === 'acevedo') {
                parishSelect.innerHTML += `
                    <option value="caucagua">Caucagua</option>
                    <option value="marizapa">Marizapa</option>
                `;
            } else if (municipality === 'brion') {
                parishSelect.innerHTML += `
                    <option value="higuerote">Higuerote</option>
                `;
            }
            
            // Mostrar opción de pago en efectivo por defecto
            document.getElementById('cashOption').style.display = 'flex';
        });
        
        // Configurar parroquia y zonas
        document.getElementById('parish').addEventListener('change', function() {
            const parish = this.value;
            
            // Ocultar todos los contenedores de zonas
            document.getElementById('caucaguaZones').style.display = 'none';
            document.getElementById('marizapaZones').style.display = 'none';
            document.getElementById('higueroteZones').style.display = 'none';
            document.getElementById('restrictedZoneMessage').style.display = 'none';
            
            // Mostrar opción de pago en efectivo por defecto
            document.getElementById('cashOption').style.display = 'flex';
            
            // Mostrar zonas según parroquia seleccionada
            if (parish === 'caucagua') {
                document.getElementById('caucaguaZones').style.display = 'block';
            } else if (parish === 'marizapa') {
                document.getElementById('marizapaZones').style.display = 'block';
            } else if (parish === 'higuerote') {
                document.getElementById('higueroteZones').style.display = 'block';
            }
        });
        
        // Configurar zona y controlar método de pago
        document.getElementById('caucaguaZone').addEventListener('change', function() {
            const zone = this.value;
            const cashOption = document.getElementById('cashOption');
            const message = document.getElementById('restrictedZoneMessage');
            
            if (restrictedZones.includes(zone)) {
                cashOption.style.display = 'none';
                message.style.display = 'block';
                
                // Si el pago en efectivo estaba seleccionado, deseleccionarlo
                if (selectedPayment && selectedPayment.startsWith('efectivo')) {
                    document.querySelectorAll('.payment-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    selectedPayment = null;
                    document.getElementById('paymentMethod').value = '';
                }
            } else {
                cashOption.style.display = 'flex';
                message.style.display = 'none';
            }
        });
        
        // Habilitar campos para segunda persona
        document.getElementById('twoPersons').addEventListener('change', function() {
            const additionalPerson = document.getElementById('additionalPerson');
            const requiredFields = additionalPerson.querySelectorAll('input[required]');
            
            if (this.checked) {
                additionalPerson.classList.add('active');
                // Hacer los campos requeridos
                requiredFields.forEach(field => field.required = true);
            } else {
                additionalPerson.classList.remove('active');
                // Eliminar el atributo required
                requiredFields.forEach(field => field.required = false);
            }
            
            // Actualizar precios
            updatePrices();
        });
        
        // Actualizar precios cuando cambia la edad
        document.getElementById('age').addEventListener('input', updatePrices);
        document.getElementById('age2').addEventListener('input', updatePrices);
        document.getElementById('twoPersons').addEventListener('change', updatePrices);
        
        // Selección de método de pago
        const paymentOptions = document.querySelectorAll('.payment-option');
        let selectedPayment = null;
        
        paymentOptions.forEach(option => {
            option.addEventListener('click', function() {
                const paymentType = this.getAttribute('data-payment');
                
                // Remover selección anterior
                paymentOptions.forEach(o => {
                    o.classList.remove('selected');
                });
                
                // Marcar como seleccionado
                this.classList.add('selected');
                selectedPayment = paymentType;
                document.getElementById('paymentMethod').value = selectedPayment;
            });
        });
        
        // Modal de términos
        const termsModal = document.getElementById('termsModal');
        const successModal = document.getElementById('successModal');
        const manageModal = document.getElementById('manageModal');
        const closeModal = document.getElementById('closeModal');
        const closeSuccessModal = document.getElementById('closeSuccessModal');
        const closeManageModal = document.getElementById('closeManageModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const acceptTerms = document.getElementById('acceptTerms');
        const whatsappBtn = document.getElementById('whatsappBtn');
        const manageAppointmentBtn = document.getElementById('manageAppointmentBtn');
        const searchAppointmentsBtn = document.getElementById('searchAppointmentsBtn');
        
        // Habilitar botón de confirmación cuando se aceptan los términos
        acceptTerms.addEventListener('change', function() {
            confirmBtn.disabled = !this.checked;
        });
        
        // Abrir modal de términos
        function openTermsModal() {
            // Crear resumen de información
            const fullName = document.getElementById('fullName').value;
            const age = document.getElementById('age').value;
            const idNumber = document.getElementById('idNumber').value;
            const phone = document.getElementById('phone').value;
            const municipality = document.getElementById('municipality').value;
            const parish = document.getElementById('parish').value;
            const paymentMethod = selectedPayment;
            const address = document.getElementById('address').value;
            const reference = document.getElementById('reference').value;
            const twoPersons = document.getElementById('twoPersons').checked;
            const consultReason = document.getElementById('consultReason').value;
            const symptoms = document.getElementById('symptoms').value;
            
            let zone = '';
            if (parish === 'caucagua') {
                zone = document.getElementById('caucaguaZone').value;
            } else if (parish === 'marizapa') {
                zone = document.getElementById('marizapaZone').value;
            } else if (parish === 'higuerote') {
                zone = document.getElementById('higueroteZone').value;
            }
            
            let price = 0;
            let priceType = "";
            
            // Calcular precio para la primera persona
            const patientAge = parseInt(age);
            let price1 = 15.00;
            let priceType1 = "General";
            
            if (patientAge < 13) {
                price1 = 12.00;
                priceType1 = "Niños";
            } else if (patientAge >= 55) {
                price1 = 12.00;
                priceType1 = "Adultos Mayores";
            }
            
            price += price1;
            
            // Información de la segunda persona
            let person2Info = "";
            if (twoPersons) {
                const fullName2 = document.getElementById('fullName2').value;
                const age2 = document.getElementById('age2').value;
                const idNumber2 = document.getElementById('idNumber2').value;
                
                let price2 = 15.00;
                let priceType2 = "General";
                
                const patientAge2 = parseInt(age2) || 0;
                if (patientAge2 < 13) {
                    price2 = 12.00;
                    priceType2 = "Niños";
                } else if (patientAge2 >= 55) {
                    price2 = 12.00;
                    priceType2 = "Adultos Mayores";
                }
                
                price += price2;
                priceType = `${priceType1} + ${priceType2}`;
                
                person2Info = `
                    <h3>Segunda Persona</h3>
                    <p><strong>Nombre:</strong> ${fullName2}</p>
                    <p><strong>Edad:</strong> ${age2}</p>
                    <p><strong>Cédula:</strong> ${idNumber2}</p>
                `;
            } else {
                priceType = priceType1;
            }
            
            // Calcular precio en bolívares
            const priceVES = (price * EXCHANGE_RATE).toFixed(2);
            
            const summary = `
                <div class="info-summary">
                    <h3>Resumen de tu solicitud</h3>
                    <p><strong>Nombre:</strong> ${fullName}</p>
                    <p><strong>Edad:</strong> ${age}</p>
                    <p><strong>Cédula:</strong> ${idNumber}</p>
                    <p><strong>Celular:</strong> ${phone}</p>
                    <p><strong>Municipio:</strong> ${municipality === 'acevedo' ? 'Acevedo' : 'Brion'}</p>
                    <p><strong>Parroquia:</strong> ${parish === 'caucagua' ? 'Caucagua' : parish === 'marizapa' ? 'Marizapa' : 'Higuerote'}</p>
                    <p><strong>Zona:</strong> ${zone}</p>
                    <p><strong>Dirección:</strong> ${address}</p>
                    ${reference ? `<p><strong>Referencia:</strong> ${reference}</p>` : ''}
                    <p><strong>Motivo de consulta:</strong> ${consultReason}</p>
                    <p><strong>Síntomas:</strong> ${symptoms}</p>
                    <p><strong>Método de pago:</strong> ${getPaymentMethodName(paymentMethod)}</p>
                    <p><strong>Precio:</strong> $${price.toFixed(2)} ${priceType} | ${priceVES} Bs</p>
                    ${person2Info}
                </div>
            `;
            
            document.getElementById('infoSummary').innerHTML = summary;
            termsModal.classList.add('active');
        }
        
        // Cerrar modal de términos
        closeModal.addEventListener('click', function() {
            termsModal.classList.remove('active');
        });
        
        cancelBtn.addEventListener('click', function() {
            termsModal.classList.remove('active');
        });
        
        // Confirmar y enviar
        confirmBtn.addEventListener('click', function() {
            if (!acceptTerms.checked) {
                alert('Por favor, acepta las condiciones de pago para continuar.');
                return;
            }
            
            // Cerrar modal de términos y mostrar modal de éxito
            termsModal.classList.remove('active');
            successModal.classList.add('active');
        });
        
        // Cerrar modal de éxito
        closeSuccessModal.addEventListener('click', function() {
            successModal.classList.remove('active');
        });
        
        // Continuar a WhatsApp
        whatsappBtn.addEventListener('click', function() {
            // Obtener datos del formulario
            const fullName = document.getElementById('fullName').value;
            const age = document.getElementById('age').value;
            const idNumber = document.getElementById('idNumber').value;
            const phone = document.getElementById('phone').value;
            const municipality = document.getElementById('municipality').value;
            const parish = document.getElementById('parish').value;
            const paymentMethod = selectedPayment;
            const address = document.getElementById('address').value;
            const reference = document.getElementById('reference').value;
            const twoPersons = document.getElementById('twoPersons').checked;
            const consultReason = document.getElementById('consultReason').value;
            const symptoms = document.getElementById('symptoms').value;
            
            let zone = '';
            if (parish === 'caucagua') {
                zone = document.getElementById('caucaguaZone').value;
            } else if (parish === 'marizapa') {
                zone = document.getElementById('marizapaZone').value;
            } else if (parish === 'higuerote') {
                zone = document.getElementById('higueroteZone').value;
            }
            
            let price = 0;
            let priceType = "";
            
            // Calcular precio para la primera persona
            const patientAge = parseInt(age);
            let price1 = 15.00;
            let priceType1 = "General";
            
            if (patientAge < 13) {
                price1 = 12.00;
                priceType1 = "Niños";
            } else if (patientAge >= 55) {
                price1 = 12.00;
                priceType1 = "Adultos Mayores";
            }
            
            price += price1;
            
            // Información de la segunda persona
            let person2Info = "";
            if (twoPersons) {
                const fullName2 = document.getElementById('fullName2').value;
                const age2 = document.getElementById('age2').value;
                const idNumber2 = document.getElementById('idNumber2').value;
                
                let price2 = 15.00;
                let priceType2 = "General";
                
                const patientAge2 = parseInt(age2) || 0;
                if (patientAge2 < 13) {
                    price2 = 12.00;
                    priceType2 = "Niños";
                } else if (patientAge2 >= 55) {
                    price2 = 12.00;
                    priceType2 = "Adultos Mayores";
                }
                
                price += price2;
                priceType = `${priceType1} + ${priceType2}`;
                
                person2Info = `
                    *Segunda Persona*
                    *Nombre:* ${fullName2}
                    *Edad:* ${age2}
                    *Cédula:* ${idNumber2}
                    
                `;
            } else {
                priceType = priceType1;
            }
            
            // Calcular precio en bolívares
            const priceVES = (price * EXCHANGE_RATE).toFixed(2);
            
            // Formatear mensaje para WhatsApp
            const message = `*Nueva Solicitud de Consulta Médica Domiciliaria*\n\n` +
                            `*Nombre:* ${fullName}\n` +
                            `*Edad:* ${age}\n` +
                            `*Cédula:* ${idNumber}\n` +
                            `*Celular:* ${phone}\n` +
                            `*Municipio:* ${municipality === 'acevedo' ? 'Acevedo' : 'Brion'}\n` +
                            `*Parroquia:* ${parish === 'caucagua' ? 'Caucagua' : parish === 'marizapa' ? 'Marizapa' : 'Higuerote'}\n` +
                            `*Zona:* ${zone}\n` +
                            `*Dirección:* ${address}\n` +
                            `${reference ? `*Referencia:* ${reference}\n` : ''}` +
                            `*Motivo de consulta:* ${consultReason}\n` +
                            `*Síntomas:* ${symptoms}\n` +
                            `*Método de Pago:* ${getPaymentMethodName(paymentMethod)}\n` +
                            `*Precio (${priceType}):* $${price.toFixed(2)} | ${priceVES} Bs\n\n` +
                            `${twoPersons ? person2Info : ''}` +
                            `_Solicitud generada el ${moment().format('DD/MM/YYYY [a las] h:mm A')}_`;
            
            // Codificar mensaje para URL
            const encodedMessage = encodeURIComponent(message);
            
            // Guardar la cita con manejo de errores
            const appointment = {
                id: Date.now(), // ID único
                fullName,
                age,
                idNumber,
                phone,
                municipality,
                parish,
                zone,
                address,
                reference,
                consultReason,
                symptoms,
                paymentMethod,
                price: price.toFixed(2),
                priceVES,
                status: 'pendiente',
                createdAt: moment().format(),
                twoPersons: twoPersons
            };
            
            if (twoPersons) {
                appointment.fullName2 = document.getElementById('fullName2').value;
                appointment.age2 = document.getElementById('age2').value;
                appointment.idNumber2 = document.getElementById('idNumber2').value;
            }
            
            appointments.push(appointment);
            
            try {
                localStorage.setItem('appointments', JSON.stringify(appointments));
            } catch (e) {
                console.log("Error al guardar en localStorage:", e);
            }
            
            // Abrir WhatsApp con el mensaje
            window.open(`https://wa.me/584264968774?text=${encodedMessage}`, '_blank');
            
            // Cerrar modal de éxito
            successModal.classList.remove('active');
        });
        
        // Enviar formulario (mostrar modal de términos)
        document.getElementById('medicalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar selección de municipio
            const municipality = document.getElementById('municipality').value;
            if (!municipality) {
                alert('Por favor, seleccione un municipio.');
                return;
            }
            
            // Validar selección de parroquia
            const parish = document.getElementById('parish').value;
            if (!parish) {
                alert('Por favor, seleccione una parroquia.');
                return;
            }
            
            // Validar selección de zona
            let zone = '';
            if (parish === 'caucagua') {
                zone = document.getElementById('caucaguaZone').value;
            } else if (parish === 'marizapa') {
                zone = document.getElementById('marizapaZone').value;
            } else if (parish === 'higuerote') {
                zone = document.getElementById('higueroteZone').value;
            }
            
            if (!zone) {
                alert('Por favor, seleccione una zona.');
                return;
            }
            
            // Validar dirección
            const address = document.getElementById('address').value;
            if (!address) {
                alert('Por favor, ingrese su dirección exacta.');
                return;
            }
            
            // Validar motivo de consulta
            const consultReason = document.getElementById('consultReason').value;
            if (!consultReason) {
                alert('Por favor, indique el motivo de la consulta.');
                return;
            }
            
            // Validar síntomas
            const symptoms = document.getElementById('symptoms').value;
            if (!symptoms) {
                alert('Por favor, describa los síntomas del paciente.');
                return;
            }
            
            // Validar método de pago
            if (!selectedPayment) {
                alert('Por favor, seleccione un método de pago.');
                return;
            }
            
            // Validar segunda persona si está habilitada
            if (document.getElementById('twoPersons').checked) {
                const fullName2 = document.getElementById('fullName2').value;
                const age2 = document.getElementById('age2').value;
                const idNumber2 = document.getElementById('idNumber2').value;
                
                if (!fullName2 || !age2 || !idNumber2) {
                    alert('Por favor, complete todos los campos para la segunda persona.');
                    return;
                }
            }
            
            // Mostrar modal de términos
            openTermsModal();
        });
        
        // Función para obtener nombre del método de pago
        function getPaymentMethodName(method) {
            switch(method) {
                case 'pago-movil': return 'Pago Móvil';
                case 'transferencia': return 'Transferencia';
                case 'vepos': return 'Monedero Patria (vePos)';
                case 'efectivo': return 'Efectivo';
                default: return 'No especificado';
            }
        }
        
        // Abrir modal de gestión de citas
        manageAppointmentBtn.addEventListener('click', function() {
            document.getElementById('searchId').value = '';
            document.getElementById('appointmentsList').innerHTML = '';
            manageModal.classList.add('active');
        });
        
        // Cerrar modal de gestión de citas
        closeManageModal.addEventListener('click', function() {
            manageModal.classList.remove('active');
        });
        
        // Buscar citas por cédula
        searchAppointmentsBtn.addEventListener('click', function() {
            const idNumber = document.getElementById('searchId').value.trim();
            if (!idNumber) {
                alert('Por favor ingrese su número de cédula.');
                return;
            }
            
            const userAppointments = appointments.filter(app => 
                (app.idNumber === idNumber || 
                (app.twoPersons && app.idNumber2 === idNumber)) && 
                app.status === 'pendiente'
            );
            
            const container = document.getElementById('appointmentsList');
            container.innerHTML = '';
            
            if (userAppointments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>No se encontraron citas activas para esta cédula</p>
                    </div>
                `;
                return;
            }
            
            userAppointments.forEach(app => {
                const appElement = document.createElement('div');
                appElement.className = 'appointment-card';
                
                let personInfo = "";
                if (app.twoPersons) {
                    personInfo = `
                        <p><strong>Segunda persona:</strong> ${app.fullName2}</p>
                    `;
                }
                
                appElement.innerHTML = `
                    <h3>Cita Médica</h3>
                    <p><strong>Nombre:</strong> ${app.fullName}</p>
                    ${personInfo}
                    <p><strong>Dirección:</strong> ${app.address}</p>
                    <p><strong>Motivo:</strong> ${app.consultReason}</p>
                    <p><strong>Método de Pago:</strong> ${getPaymentMethodName(app.paymentMethod)}</p>
                    <button class="cancel-appointment-btn" data-id="${app.id}">
                        <i class="fas fa-times-circle"></i> Cancelar Cita
                    </button>
                `;
                container.appendChild(appElement);
            });
        });
        
        // Cancelar una cita
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('cancel-appointment-btn')) {
                const appointmentId = parseInt(e.target.getAttribute('data-id'));
                const appointmentIndex = appointments.findIndex(app => app.id === appointmentId);
                
                if (appointmentIndex !== -1) {
                    const appointment = appointments[appointmentIndex];
                    
                    // Confirmación antes de cancelar
                    if (confirm(`¿Está seguro que desea cancelar la cita?`)) {
                        // Marcar cita como cancelada
                        appointments[appointmentIndex].status = 'cancelada';
                        
                        try {
                            localStorage.setItem('appointments', JSON.stringify(appointments));
                        } catch (e) {
                            console.log("Error al actualizar localStorage:", e);
                        }
                        
                        // Volver a buscar citas
                        searchAppointmentsBtn.click();
                        
                        alert('Cita cancelada exitosamente.');
                    }
                }
            }
        });
    </script>
</body>
</html>
